{
  "CanalVendas": {
    "prefix": "Dimensoes",
    "body": [
      "import pandas as pd",
      "import sys",
      "sys.path.insert(0, r'C:\\oracle\\dwh')",
      "from OracleDWH import conn",
      "pd.options.display.float_format = '{:,.2f}'.format",
      "",
      "mysql = (\"\"\"     ",
      "SELECT DISTINCT ",
      "    CODCNLVND,",
      "    DESCNLVND ",
      "  FROM DWH.DIMCNLVND  ",
      "WHERE CODCNLVND >= 0 ",
      "    AND CODSPRTIPCNLVND = 'CNLVNDINI'",
      "  \"\"\")",
      "df = pd.read_sql(mysql, con=conn)",
      "conn.close()"
    ]
  },
  "Clientes": {
    "prefix": "Dimensoes",
    "body": [
      "import pandas as pd",
      "import sys",
      "sys.path.insert(0, r'C:\\oracle\\dwh')",
      "from OracleDWH_eltonl import conn",
      "",
      "#Consulta",
      "mysql = (\"\"\"",
      "SELECT CODCLIEND AS CODCLI",
      "        , NOMRAZSOCCLI AS RAZAO_SOCIAL",
      "        , NUMCEPCLI AS CEP",
      "        , TRIM(DESLGRCLI)||', '||DIMCLIEND.NUMLGRCLI AS ENDERECO",
      "        , TRIM(NOMBAICLI) AS BAIRRO",
      "        , CODIBGMNCCLI AS CODIBGE_CIDADE",
      "        , NOMMNCCLI AS CIDADE",
      "        , CODESTCLI AS UF",
      "        , CODTIPPESCLIEND AS TIPPESCLI",
      "        , NUMCPECGCCPFCLI AS CNPJ",
      "        , DESATICLI AS ATIVIDADE",
      "        , NUMCHCCLI AS NUMCHCCLI",
      "        , VLRMORFATCLIMCD AS FATMCDMES",
      "        , CODATIRCTFED AS CNAE",
      "    FROM DWH.DIMCLIEND",
      "    where CODTIPENDCLI = 0",
      "        and TO_CHAR(DATULTCMPCLI, 'YYYYMMDD') >= '20200101'",
      "  \"\"\")",
      "dimcli = pd.read_sql(mysql, con=conn)",
      "conn.close()",
      "",
      "#dimcli.query('RAZAO_SOCIAL.str.contains(\"SMART\")')",
      "#dimcli.query('RAZAO_SOCIAL.str.contains(\"SMART\") and RAZAO_SOCIAL.str.contains(\"SUPER\")')"
    ]
  },
  "CompradorPrincipal": {
    "prefix": "Dimensoes",
    "body": [
      "#Gera o cadastro dos compradores por fornecedor na sequencia das filiais mais relevantes na ordem (1, 52, 41, 64, 99, 397, e demais)",
      "#CODDIVFRN e unico (is key)",
      "",
      "import pandas as pd",
      "import sys",
      "sys.path.insert(0, r'C:\\oracle\\dwh')",
      "from OracleDWH import conn",
      "pd.options.display.float_format = '{:,.2f}'.format",
      "",
      "mysql = (\"\"\"     ",
      "   SELECT CODDIVFRN, ",
      "          DESDIVFRN, ",
      "          CODGRPECOFRN, ",
      "          NOMGRPECOFRN, ",
      "          CODDRTCLLATU, ",
      "          DESDRTCLLATU, ",
      "          CODFNCDRTCLLATU, ",
      "          NOMFNCDRTCLLATU, ",
      "          CODCLLCMPATU, ",
      "          DESCLLCMPATU, ",
      "          CODCPRATU, ",
      "          CODFNCCPRATU, ",
      "          NOMCPRATU,",
      "          CODFIL",
      "      FROM DWH.DIMFILFRN",
      "  \"\"\")",
      "dfsql = pd.read_sql(mysql, con=conn)",
      "conn.close()",
      "",
      "#Insere registros na sequencia das principais filiais (inicia com Uberlandia = 1)",
      "df = dfsql.query('CODFIL==1 & CODCPRATU>0')",
      "df = df.append(dfsql.query('CODFIL==52 & CODCPRATU>0'))",
      "df = df.append(dfsql.query('CODFIL==41 & CODCPRATU>0'))",
      "df = df.append(dfsql.query('CODFIL==64 & CODCPRATU>0'))",
      "df = df.append(dfsql.query('CODFIL==99 & CODCPRATU>0'))",
      "df = df.append(dfsql.query('CODFIL==397 & CODCPRATU>0'))",
      "df = df.append(dfsql[(~dfsql.CODFIL.isin([1,52,41,64,99,397])) & (dfsql['CODCPRATU']>0)]) #insere restante das filiais",
      "df = df.append(dfsql.query('CODCPRATU<0'))",
      "",
      "#Filtra o primeiro registro encontrado no dataset df (pega o comprador na ordem das filiais mais relevantes)",
      "#campos = ['CODDIVFRN', 'DESDIVFRN', 'CODGRPECOFRN', 'NOMGRPECOFRN', 'CODDRTCLLATU', 'DESDRTCLLATU', 'CODFNCDRTCLLATU', 'NOMFNCDRTCLLATU', 'CODCLLCMPATU', 'DESCLLCMPATU', 'CODCPRATU', 'CODFNCCPRATU', 'NOMCPRATU']",
      "df = df.drop_duplicates(['CODDIVFRN'])",
      "",
      "#Exporta para csv",
      "#df.to_csv(r'CPRPCPFRN.csv', sep=\";\", encoding=\"iso-8859-1\", decimal=\",\", float_format='%.2f', date_format='%d/%m/%Y', index=False)",
      ""
    ]
  },
  "EntidadeOMD": {
    "prefix": "Dimensoes",
    "body": [
      "import pandas as pd",
      "import sys",
      "sys.path.insert(0, r'C:\\oracle\\dwh')",
      "from OracleDWH import conn",
      "pd.options.display.float_format = '{:,.2f}'.format",
      "",
      "mysql = (\"\"\"     ",
      "SELECT A.CODEDEOCDATU AS CODEDE",
      "      , A.CODCENCSTATU",
      "      , A.DESEDEOCDATU",
      "  FROM DWH.DIMEDEOCDATU A",
      " WHERE (DATDSTEDEOCDATU IS NULL OR  DATDSTEDEOCDATU >= date'2018-01-01')",
      "   AND CODEDEOCDATU < 9999",
      "   AND CODEDEOCDATU > 0",
      "  \"\"\")",
      "df = pd.read_sql(mysql, con=conn)",
      "conn.close()"
    ]
  },
  "Produtos": {
    "prefix": "Dimensoes",
    "body": [
      "import pandas as pd",
      "import sys",
      "sys.path.insert(0, r'C:\\oracle\\dwh')",
      "from OracleDWH_eltonl import conn",
      "",
      "#Consulta",
      "mysql = (\"\"\"",
      "SELECT DISTINCT CODPRD AS CODPRD",
      ", DESPRD AS PRODUTO",
      ", CODDIVFRN AS CODFRN",
      ", DESDIVFRN AS FORNECEDOR",
      ", NOMGRPECOFRN AS NOMGRPECOFRN",
      ", CODGRPPRD AS CODGRPPRD",
      ", DESGRPPRD AS GRUPO_PRODUTO",
      ", CODCTGPRD AS CODCTGPRD",
      ", DESCTGPRD AS CATEGORIA_PRODUTO",
      ", CODSUBCTGPRD AS CODSUBCTGPRD",
      ", DESSUBCTGPRD AS SUBCATEGORIA_PRODUTO",
      ", DESCLLCMPATU AS CELULA",
      ", DESDRTCLLATU AS DIRETORIA",
      "FROM (",
      "Select DISTINCT CODPRD, DESPRD, CODDIVFRN, DESDIVFRN, NOMGRPECOFRN, CODGRPPRD, DESGRPPRD, CODCTGPRD, DESCTGPRD, CODSUBCTGPRD, DESSUBCTGPRD, DESCLLCMPATU, DESDRTCLLATU, DATATURGT, ROW_NUMBER() OVER(PARTITION BY CODPRD ORDER BY DATATURGT DESC) AS RowNumber",
      "from dwh.dimprd ",
      "where CODSPRTIPPRD = 'PRD'",
      "ORDER BY DATATURGT DESC",
      ")",
      "where RowNumber = 1",
      "  \"\"\")",
      "dimprd = pd.read_sql(mysql, con=conn)",
      "conn.close()",
      "",
      "#dimprd.query('PRODUTO.str.contains(\"SMART\")')",
      "#dimprd.query('PRODUTO.str.contains(\"SMART\") and PRODUTO.str.contains(\"NOKIA\")')"
    ]
  },
  "TipoNegocioCliente": {
    "prefix": "Dimensoes",
    "body": [
      "import pandas as pd",
      "import sys",
      "sys.path.insert(0, r'C:\\oracle\\dwh')",
      "from OracleDWH import conn",
      "pd.options.display.float_format = '{:,.2f}'.format",
      "",
      "mysql = (\"\"\"     ",
      "SELECT CODUNDNGCCLI",
      "  , DESUNDNGCCLI ",
      "FROM DWH.DIMSGMMCDCLI ",
      "WHERE CODSPRTIPSGMMCDCLI = 'UNDNGCCLI' ",
      "  \"\"\")",
      "df = pd.read_sql(mysql, con=conn)",
      "conn.close()"
    ]
  }
}